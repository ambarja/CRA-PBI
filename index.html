<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducci√≥n a datos e informaci√≥n de pron√≥sticos para construir mapas de PBI</title>
    <meta charset="utf-8" />
    <meta name="author" content="Antony Barja" />
    <meta name="author" content="Consultor Cruz Roja Alemana" />
    <meta name="date" content="2022-07-25" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <script src="index_files/htmlwidgets/htmlwidgets.js"></script>
    <script src="index_files/jquery/jquery.min.js"></script>
    <link href="index_files/leaflet/leaflet.css" rel="stylesheet" />
    <script src="index_files/leaflet/leaflet.js"></script>
    <link href="index_files/leafletfix/leafletfix.css" rel="stylesheet" />
    <script src="index_files/proj4/proj4.min.js"></script>
    <script src="index_files/Proj4Leaflet/proj4leaflet.js"></script>
    <link href="index_files/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
    <script src="index_files/leaflet-binding/leaflet.js"></script>
    <script src="index_files/leaflet-providers/leaflet-providers_1.9.0.js"></script>
    <script src="index_files/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>
    <link href="index_files/HomeButton/home-button.css" rel="stylesheet" />
    <script src="index_files/HomeButton/home-button.js"></script>
    <script src="index_files/HomeButton/easy-button-src.min.js"></script>
    <script src="index_files/clipboard/setClipboardText.js"></script>
    <link href="index_files/mapviewCSS/mapview-popup.css" rel="stylesheet" />
    <link href="index_files/mapviewCSS/mapview.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Introducci√≥n a datos e informaci√≥n de pron√≥sticos para construir mapas de PBI
]
.subtitle[
## üåßÔ∏è Ni√±o Costero Per√∫ 2017 <br/>üåÄ Tif√≥n Molave Vietnam 2020
]
.author[
### Antony Barja
]
.author[
### Consultor Cruz Roja Alemana
]
.date[
### 2022-07-25
]

---






class: inverse center middle

# Consideraciones t√©cnicas

---
# Requerimientos

Para poder replicar los 2 ejercicios propuestos es necesario contar con la instalaci√≥n y configuracion de los siguientes softwares y datos: 

Software | Datos
---|---
- QGIS         |  - [üì• Pronostico y datos I](https://github.com/ambarja/CRA-PBI/raw/main/resources/Ni%C3%B1oCostero/datos_ni%C3%B1o2017.gpkg)
- R &amp; Rstudio  |  - [üì• Pronostico y datos II](https://github.com/ambarja/CRA-PBI/raw/main/resources/Tifon/datos_tifon2020.gpkg)

*Paquetes dentro del software R:*
 - `tidyverse`
 - `rgee`
 - `sf`
 - `mapview`
---
# Flujo de trabajo 
&lt;br&gt;
&lt;br&gt;
&lt;br&gt;
&lt;p align="center"&gt;&lt;img src="./img/workflow.svg" width="100%"/&gt;&lt;/p&gt;
---
# Trabajando con el software QGIS 

&lt;p align="center"&gt;&lt;img src="https://user-images.githubusercontent.com/23284899/180781589-117b5fd0-035a-494f-b06c-6e6a0311df52.png" width="900px"/&gt;&lt;/p&gt;

---

class: inverse center middle

# Ejemplo para el &lt;br&gt;üåßÔ∏è Ni√±o Costero 2017 Per√∫

---
# Descargando informaci√≥n de pron√≥stico

.pull-left[
 ![senamhi_01](https://user-images.githubusercontent.com/23284899/180781595-6e52fab9-aa1b-4a38-8185-60fd685d65ce.png)
]

.pull-right[
 ![senamhi_02](https://user-images.githubusercontent.com/23284899/180781598-2e6c0c06-390e-4344-a87b-fca51aaa40fc.png)
]

---
# Ni√±o 2017
.pull-left[
&lt;img src="https://user-images.githubusercontent.com/23284899/180781612-7d57e63a-6589-4a12-944b-8352264dac29.png" width="300px"&gt;
]

.pull-right[
&lt;img src="https://user-images.githubusercontent.com/23284899/180781613-f932d302-1f2f-471a-9ef9-6ea6017b6f0e.png" width="600px"&gt;
]

.footnote[[üì• Clic para descargar ejemplo](https://www.senamhi.gob.pe/?p=aviso-meteorologico-detalle&amp;a=2017&amp;b=034&amp;c=022&amp;d=SENA)]

---
# Lectura e intersecci√≥n de capas vectoriales
&lt;p align="center"&gt;&lt;img src="https://user-images.githubusercontent.com/23284899/180781615-98c1090f-90f2-4173-8721-55903a5387d4.png" width="900px"/&gt;&lt;/p&gt;
---
# Estad√≠stica zonal 

&lt;p align="center"&gt;&lt;img src="https://user-images.githubusercontent.com/23284899/180781616-2d52d9c2-9161-442d-b56e-691c7179819d.png" width="800px"/&gt;&lt;/p&gt;
.footnote[[üì• Clic para descargar ejemplo](https://data.humdata.org/dataset/peru-high-resolution-population-density-maps-demographic-estimates)]
---
# Tabla de resumen

&lt;table&gt;
&lt;caption&gt;Posibles distritos de mayor afectaci√≥n&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; fid &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; NOMBDEP &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; NOMBPROV &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; NOMBDIST &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; UBIGEO &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; IR2 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p65 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p05 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 73 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CATACAOS &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200105 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.0000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5908 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7801 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 79 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TAMBO GRANDE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.2369 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9806 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14947 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 30 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; LAMBAYEQUE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; LAMBAYEQUE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; MORROPE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 140306 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.6483 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 71 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; LA ARENA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200109 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.5596 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3126 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4823 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; MORROPON &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CHULUCANAS &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200401 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.8393 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7742 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7246 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 54 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; PIURA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SULLANA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; SULLANA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200601 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.7149 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17568 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21928 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
class: inverse center middle

# Ejemplo para el &lt;br&gt;üåÄ Tif√≥n Molave Vietnam 2020

---
# Descargando informaci√≥n de pron√≥stico

.pull-left[
 ![senamhi_01](https://user-images.githubusercontent.com/23284899/180781600-5f6ec1d8-5f89-4eb9-b718-5907b90ec69f.png)
]

.pull-right[
 ![senamhi_02](https://user-images.githubusercontent.com/23284899/180781605-1b402afc-6d87-4504-8438-b9b69f566399.png)
]
---
# Lectura y georreferenciaci√≥n

&lt;p align="center"&gt;&lt;img src="https://user-images.githubusercontent.com/23284899/180781609-25452791-35f1-413e-913c-04ed918eb186.png" width="900px"/&gt;&lt;/p&gt;

---
# Digitalizaci√≥n y estad√≠stica zonal 
&lt;p align="center"&gt;&lt;img src="https://user-images.githubusercontent.com/23284899/180781610-4a4979a2-dc2d-4a02-aa9f-d57e3805bd36.png" width="800px"/&gt;&lt;/p&gt;
.footnote[[üì• Clic para descargar datos de poblaci√≥n](https://data.humdata.org/dataset/vietnam-high-resolution-population-density-maps-demographic-estimates)]
---
# Tabla de resumen 

&lt;table&gt;
&lt;caption&gt;Tabla de ni√±os y adultos por admin&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; ADM1_EN &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Pronostico &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; ni√±os.05 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adultos.60 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Binh Dinh &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 63879 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 85817 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Gia Lai &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 327 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 158 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Kon Tum &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6783 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2784 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Quang Nam &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 35472 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49984 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Quang Ngai &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt;90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 98343 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 142918 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
&lt;caption&gt;Tabla de poblacion por niveles&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; X &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; value &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6520944 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt; 90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5314314 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 30 - 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2175340 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: inverse center middle

# Intento de automatizar la generaci√≥n de reportes 

---
# Lectura de pron√≥stico e informaci√≥n de riesgo


```r
library(tidyverse)
library(sf)
library(mapview)
library(rgee)
ee_Initialize(user = "antony.barja@upch.pe)
```



<div id="htmlwidget-833ce304cc67632fcbba" style="width:100%;height:252px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-833ce304cc67632fcbba">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[104.998843482103,105.101627429248,105.637572296503,106.569969531318,107.605150713278,109.491970314438,109.895764392508,110.549176627929,110.997020969061,110.960312416509,110.512468075377,108.809191236976,108.471472553499,108.097045317471,107.465658213581,105.828456769773,104.998843482103],"lat":[15.4540482486937,16.0046765369701,16.2396112733014,16.4378374570809,16.5039128516741,16.4304957465706,16.0046765369701,16.0267016685012,15.4907568012455,13.9710227256025,13.5525452265124,13.5158366739607,13.6112789105952,13.9710227256025,14.0958318042785,14.8960782499069,15.4540482486937]}]],[[{"lng":[107.781351765526,107.751984923485,108.339321764313,108.581598211155,108.926658605141,110.505126364867,110.556518338439,109.513995445969,108.030969922878,107.884135712671,107.781351765526],"lat":[15.4540482486937,15.0062039075622,14.5143093033686,14.3895002246926,13.9269724625404,13.9783644361129,15.6229075904318,15.5568321958386,15.6082241694111,15.5274653537972,15.4540482486937]}]],[[{"lng":[109.580070840563,108.934000315652,108.383372027375,107.942869396754,107.091230977553,106.731487162546,106.584652952339,106.951738477856,107.23072347725,107.561100450216,108.221854396147,109.007417420755,109.190960183514,109.638804524645,110.490442943846,110.77676965375,110.78411136426,110.57120175946,110.461076101805,109.580070840563],"lat":[13.647987463147,13.6553291736574,14.1251986463199,14.2573494355063,14.8740531183759,15.0796210126657,15.5274653537972,15.813792063701,15.9753096949287,16.0487268000323,16.188219299729,16.1441690366668,16.1368273261565,15.8945508793149,15.8431589057424,15.5127819327765,13.9930478571336,13.7140628577402,13.6700125946781,13.647987463147]}]]],null,"pronostico",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>1&emsp;<\/td><\/tr><tr><td>2<\/td><th>value&emsp;<\/th><td>< 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>geom&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>2&emsp;<\/td><\/tr><tr><td>2<\/td><th>value&emsp;<\/th><td>30 - 40&emsp;<\/td><\/tr><tr><td>3<\/td><th>geom&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>3&emsp;<\/td><\/tr><tr><td>2<\/td><th>value&emsp;<\/th><td>> 90&emsp;<\/td><\/tr><tr><td>3<\/td><th>geom&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[104.998843482103,13.5158366739607,110.997020969061,16.5039128516741,true,"pronostico","Zoom to pronostico","<strong> pronostico <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"pronostico",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["pronostico"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"pronostico"}]}],"limits":{"lat":[13.5158366739607,16.5039128516741],"lng":[104.998843482103,110.997020969061]},"fitBounds":[13.5158366739607,104.998843482103,16.5039128516741,110.997020969061,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>




---

# Estad√≠stica zonal 

```r
zona_impactada &lt;- function(x){ 
  # Nivel de pronostico 
  nivel &lt;- pronostico[x,]
  # Intersecci√≥n de capas
  nuevos_limites &lt;- st_intersection(x = limites,y = nivel) %&gt;% 
    dplyr::select(ADM1_EN,value) %&gt;% 
    sf_as_ee()
  # Datos de poblaci√≥n de Earth Engine
  poblacion_estimada &lt;- ee$ImageCollection$Dataset$WorldPop_GP_100m_pop$
    select('population')$
    filter(ee$Filter$calendarRange(2020,2020, "year"))$
    mosaic()$
    rename('pop')
 # Estadistica zonal 
  stat_general &lt;- ee_extract(
    x = poblacion_estimada,
    y = nuevos_limites,
    fun = ee$Reducer$sum(),
    scale = 100)
  stat_final &lt;- stat_general %&gt;% 
    mutate(pop = round(pop,0))
  return(stat_final)
}
```

---
# Generaci√≥n de reporte

```r
# Resultados finales en listas
lista_stat &lt;- lapply(X = 1:3,FUN = zona_impactada) 

# Tabla final por valores
datos_finales &lt;- lista_stat %&gt;% 
  map_df(.f = as_tibble) %&gt;% 
  group_by(value) %&gt;% 
  summarise(pop = sum(pop,na.rm = TRUE))
```

&lt;table&gt;
&lt;caption&gt;Tabla de poblacion posiblemente afectada por niveles de pron√≥stico&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; ...1 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; value &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; pop &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;lt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6520944 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; &amp;gt; 90 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5314314 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 30 - 40 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2175340 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;



---
class: center, middle

# Gracias!

Slides creados con los siguientes paquetes de  R:

[**xaringan**](https://github.com/yihui/xaringan)&lt;br&gt;
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%/%total%",
"highlightStyle": "idea",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
